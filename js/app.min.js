"use strict";$(document).ready(function(){function e(e,t){switch(t){case"show":$("#mask").fadeIn(f),$(e).fadeIn(f);break;case"hide":$("#mask").fadeOut(f),$(e).fadeOut(f)}}function t(e){switch(e){case"show":$("#backgroundImage").fadeIn(f);break;case"hide":$("#backgroundImage").fadeOut(f)}}function n(e){var t=$(e);t.css("display","block"),setTimeout(function(){t.css({opacity:"1.0",transform:"scale(1)"})},50)}function o(e,t){var o=$(t);o.css({transform:"scale("+h+")",opacity:"0"}),setTimeout(function(){o.css({display:"none",transform:"scale(0)"})},f),n(e)}function i(e,t){var o=$(e),i=$(t);i.css({opacity:"0",transform:"scale(0)"}),setTimeout(function(){i.css("display","none")},f),o.css({transition:"0ms",transform:"scale("+h+")"}),setTimeout(function(){o.css("transition",f+"ms"),n(e)})}function a(){$("#origin").tooltipster("close"),$("#destination").tooltipster("close"),$("#waypoints").tooltipster("close"),$("#peopleCounter").tooltipster("close"),$("#datePickers").tooltipster("close"),$("#journeyName").tooltipster("close")}function r(e,t){$.ajax({method:"GET",url:e}).done(function(e){void 0!==t&&t(e)})}function s(e,t,n,o){var i=new MapboxGeocoder({accessToken:mapboxgl.accessToken,country:"NZ",limit:5,placeholder:n}),r=$(".mapboxgl-ctrl-top-right");if(t.addControl(i),$(e)[0].appendChild(i.onAdd(t)),o){var s=$(e).children();s[s.length-1].setAttribute("id",o)}r[0].removeChild(r[0].children[0]);for(var c=$("#waypoints").children(),l=null,u=function(e){!function(t){c[e].onclick=function(){l=t}}(e)},d=0;d<c.length;d++)u(d);i.on("result",function(n){switch(a(),e){case"#origin":k.origin=n,$("#sectionTwoButtonNext").animateCss("bounce");break;case"#destination":k.destination=n,$("#sectionFourButtonNext").animateCss("bounce");break;case"#waypoints":v===[]?v.push(n):v.splice(l,1,n),$("#sectionThreeButtonNext").animateCss("bounce")}t.flyTo({center:n.result.center,zoom:11,speed:2.5})})}function c(e,t,n,o){for(var i=m+e[0]+","+e[1]+";",a=0;a<n.length;a++)i+=n[a].result.geometry.coordinates[0]+","+n[a].result.geometry.coordinates[1]+";";i+=t[0]+","+t[1],i+="?overview=full&geometries=geojson",r(i+="&access_token="+mapboxgl.accessToken,function(e){var t=e.routes[0].geometry,n=y.getSource("route");n?(n.setData(t),y.setLayoutProperty("route","visibility","visible")):(y.addSource("route",{type:"geojson",data:{type:"Feature",geometry:t}}),y.addLayer({id:"route",type:"line",source:"route",layout:{visibility:"visible"},paint:{"line-width":2}}));for(var i=0;i<k.markers.length;i++)k.markers[i].remove();e.waypoints.forEach(function(t,n){var o=document.createElement("div");o.className="fa fa-map-marker marker";var i=new mapboxgl.Marker(o,{offset:[0,-20]}).setLngLat(e.waypoints[n].location).addTo(y);k.markers.push(i)});var a=t.coordinates,r=a.reduce(function(e,t){return e.extend(t)},new mapboxgl.LngLatBounds(a[0],a[0]));y.fitBounds(r,{padding:{top:150,left:50,right:50,bottom:80}}),w.data=e,void 0!==o&&o()})}function l(e){var t=parseInt($("#peopleCounterNumber").text());if(clearTimeout(N),a(),t<=1&&"decrease"===e)$("#peopleCounter").tooltipster("content","You can't have less than 1 person"),$("#peopleCounter").tooltipster("open");else if(t>=6&&"increase"===e)$("#peopleCounter").tooltipster("content","You can't have more than 6 people"),$("#peopleCounter").tooltipster("open");else switch(e){case"increase":$("#peopleCounterNumber").text(t+1);break;case"decrease":$("#peopleCounterNumber").text(t-1)}N=setTimeout(function(){a()},2500)}function u(e,t,n){var o=e*(t/100)*n;return["$"+o.toFixed(2)+" NZD",parseFloat(o.toFixed(2))]}function d(){D.days.startDay&&D.days.endDay?(a(),function(e,t){var n=(t-e)/864e5;n<=0?($("#datePickers").tooltipster("content","You can't have a hire for less than 1 day"),$("#datePickers").tooltipster("open")):(a(),D.days.totalDays=n)}(D.days.startDay,D.days.endDay),D.days.totalDays>0&&D.days.totalDays<=15?(r("./ajax/vehicle_template.html",function(e){b=e}),r("./json/vehicleInfo.json",function(t){for(var n=(x=t).vehicles,i=[],a=[],r=[],s=0;s<n.length;s++)D.days.totalDays>=n[s].hireDays.min&&D.days.totalDays<=n[s].hireDays.max?i.push(n[s]):i.push(!1),D.persons>=n[s].persons.min&&D.persons<=n[s].persons.max?a.push(n[s]):a.push(!1);for(var c=0;c<n.length;c++)i[c]===a[c]&&i[c]&&!1!==a[c]&&r.push(n[c]);for(var l=0;l<r.length;l++){var u=$.parseHTML(b)[0],d=u.children[0].children[0];u.setAttribute("id",r[l].vehicle),d.children[0].textContent=r[l].name,d.children[1].setAttribute("src",r[l].imageURL),d.children[2].textContent="$"+r[l].dailyRate+".00/day",d.children[3].setAttribute("id",r[l].vehicle+"MoreInfo"),$(".vehicle-options").slick("slickAdd",u)}setTimeout(function(){switch(o("#sectionSeven","#sectionSix"),$(".vehicle-options").slick("slickPause"),r.length){case 0:e("#noVehicleMatchesPopup","show");break;case 1:$(".slick-track").css("width","auto"),$(".vehicle-option").css({width:"auto",float:"none"})}},f),r.length<=1?$("#sectionSeven .inner .content p").css("display","none"):$("#sectionSeven .inner .content p").css("display","block"),$(".vehicle-options").slick("slickGoTo",0)})):($("#datePickers").tooltipster("content","Please make sure the dates selected are between 1 and 15 days"),$("#datePickers").tooltipster("open"))):($("#datePickers").tooltipster("content","Please make sure you have selected a start and end date"),$("#datePickers").tooltipster("open"))}function p(){P=[],T=[],$("#savedTrips").empty();for(var e=0;e<localStorage.length;e++)localStorage.key(e).indexOf("wayfindr_")>-1&&(P.push(localStorage.getItem(localStorage.key(e))),T.push(localStorage.key(e)));if(0!==P.length){$("#loadJourneyPopup")[0].children[0].children[1].textContent="Here are all of your saved journeys";for(var n=function(e){$(document).off("click","#loadJourney"+e);var n=document.createElement("button");n.className="btn btn-style-dark load-trip-button",n.setAttribute("id","loadJourney"+e),n.textContent="Load: "+T[e].substring(9),$(document).on("click","#loadJourney"+e,function(n){!function(e,n){e.preventDefault();var i=JSON.parse(P[n]),a=i.mapPoints,r=k.markers,l=i.hireInfo,u=i.routeInfo;if(a.markers=r,v=a.waypoints,k=a,D=l,w=u,$("#origin")[0].children[0].children[1].value=a.origin.result.place_name,0===v.length&&($("#waypoints")[0].children[0].children[1].value=""),v.length>0&&($("#waypoints")[0].children[0].children[1].value=v[0].result.place_name),v.length>1)for(var p=1;p<v.length;p++)s("#waypoints",y,"Please enter a stop"),$("#waypoints")[0].children[p].children[1].value=v[p].result.place_name;$("#destination")[0].children[0].children[1].value=a.destination.result.place_name,$("#peopleCounterNumber")[0].textContent=l.persons,$("#datePickers")[0].children[0].value=$('[data-toggle="pickupDate"]').datepicker("formatDate",new Date(l.days.startDay)),$("#datePickers")[0].children[3].value=$('[data-toggle="returnDate"]').datepicker("formatDate",new Date(l.days.endDay)),$("#loadJourneyPopup").fadeOut(f),c(a.origin.result.geometry.coordinates,a.destination.result.geometry.coordinates,v,function(){t("hide"),d(),o("#sectionSeven","#sectionOne")})}(n,e)}),$("#savedTrips").append(n)},i=0;i<P.length;i++)n(i)}else $("#loadJourneyPopup")[0].children[0].children[1].textContent="You don't seem to have any saved journeys. Journeys you save will appear here!"}$.fn.extend({animateCss:function(e,t){return this.addClass("animated "+e).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated "+e),t&&t()}),this}});var f=400,h=2,m="https://api.mapbox.com/directions/v5/mapbox/driving/";mapboxgl.accessToken="pk.eyJ1IjoiZm9ycmVzdHdpbHNvbiIsImEiOiJjamFicGc4ejAwMmN0MnFxdWY3OGYyMW04In0.8hjX9IJyvPY_lkNdoaIBfw";var y=new mapboxgl.Map({container:"map",style:"mapbox://styles/forrestwilson/cjaou8vqqfup52spf1xsw4o2f",center:[172.5,-41.278919],zoom:4.5,interactive:!1}),v=[],g=!0,k={origin:null,waypoints:[],destination:null,markers:[]},D={persons:null,days:{startDay:null,endDay:null,totalDays:null}},w={data:null,distance:null},x=null,b=null,P=[],T=[],N=void 0;$("#showHideMap").click(function(e){e.preventDefault(),g?($("#sectionSeven .inner .content").fadeOut(f),g=!1):($("#sectionSeven .inner .content").fadeIn(f),g=!0)}),$("#howToText").click(function(t){t.preventDefault(),e("#howDoIWorkPopup","show")}),$("#howDoIWorkPopupClose").click(function(t){t.preventDefault(),e("#howDoIWorkPopup","hide")}),$("#sectionOneButton").click(function(e){e.preventDefault(),o("#sectionTwo","#sectionOne"),t("hide")}),$("#loadJourney").click(function(t){t.preventDefault(),p(),e("#loadJourneyPopup","show")}),$("#loadJourneyPopupClose").click(function(t){t.preventDefault(),e("#loadJourneyPopup","hide")}),$("#sectionTwoButtonNext").click(function(e){e.preventDefault(),k.origin?o("#sectionThree","#sectionTwo"):$("#origin").tooltipster("open")}),$("#sectionTwoButtonBack").click(function(e){e.preventDefault(),a(),t("show"),i("#sectionOne","#sectionTwo")}),$("#sectionThreeButtonNext").click(function(e){e.preventDefault();var t=$("#waypoints").children();k.waypoints=[];for(var n=0;n<t.length;n++)""!==t[n].children[1].value&&k.waypoints.push(v[n]);a(),o("#sectionFour","#sectionThree")}),$("#sectionThreeButtonBack").click(function(e){e.preventDefault(),a(),i("#sectionTwo","#sectionThree")}),$("#anotherStop").click(function(e){e.preventDefault();var t=$("#waypoints").children(),n=[];a();for(var o=0;o<t.length;o++)n.push(t[o].children[1].value);n.every(function(e){return""!==e})?s("#waypoints",y,"Please enter a stop"):($("#waypoints").tooltipster("open"),setTimeout(function(){a()},2500))}),$("#sectionFourButtonNext").click(function(e){e.preventDefault(),k.destination?c(k.origin.result.geometry.coordinates,k.destination.result.geometry.coordinates,k.waypoints,function(){o("#sectionFive","#sectionFour");var e=function(e,t){void 0===t&&(t=1);var n=Number(Math.round(e/1e3+"e"+t)+"e-"+t);return[n+"km",n]}(w.data.routes[0].distance),t=function(e){var t=e/450;return t<1?1:t>=7?15:Math.ceil(t)}(e[1]);w.distance=e,$("#minDaysHireSuggestion").text(t)}):$("#destination").tooltipster("open")}),$("#sectionFourButtonBack").click(function(e){e.preventDefault(),a(),i("#sectionThree","#sectionFour")}),$("#decreasePeopleCounter").click(function(e){e.preventDefault(),l("decrease")}),$("#increasePeopleCounter").click(function(e){e.preventDefault(),l("increase")}),$("#sectionFiveButtonNext").click(function(e){e.preventDefault(),D.persons=$("#peopleCounterNumber").text(),a(),o("#sectionSix","#sectionFive")}),$("#sectionFiveButtonBack").click(function(e){e.preventDefault(),a(),i("#sectionFour","#sectionFive")}),$('[data-toggle="pickupDate"]').on("pick.datepicker",function(e){D.days.startDay=Date.parse(e.date),$('[data-toggle="returnDate"]').datepicker("setStartDate",new Date(D.days.startDay))}),$('[data-toggle="returnDate"]').on("pick.datepicker",function(e){D.days.endDay=Date.parse(e.date),$('[data-toggle="pickupDate"]').datepicker("setEndDate",new Date(D.days.endDay))}),$('[data-toggle="pickupDate"], [data-toggle="returnDate"]').datepicker({autoHide:!0,format:"dd/mm/yyyy",startDate:new Date}),$('[data-toggle="pickupDate"], [data-toggle="returnDate"]').on("pick.datepicker",function(e){D.days.startDay&&D.days.endDay&&$("#sectionSixButtonNext").animateCss("bounce")}),$("#sectionSixButtonNext").click(function(e){e.preventDefault(),d()}),$("#sectionSixButtonBack").click(function(e){e.preventDefault(),a(),i("#sectionFive","#sectionSix")}),$("#moreVehicleInfoPopupClose").click(function(t){t.preventDefault(),e("#moreVehicleInfoPopup","hide")}),$("#editJourney").click(function(e){e.preventDefault(),$(".vehicle-option").each(function(){$(".vehicle-options").slick("slickRemove",0)}),i("#sectionTwo","#sectionSeven")}),$("#saveJourney").click(function(t){t.preventDefault(),e("#saveJourneyNamePopup","show")}),$("#declineSave").click(function(t){t.preventDefault(),a(),e("#saveJourneyNamePopup","hide")}),$("#confirmSave").click(function(t){t.preventDefault(),function(e,t){if(""!==e){var n={},o="wayfindr_"+e;n.mapPoints={},n.mapPoints.destination=k.destination,n.mapPoints.origin=k.origin,n.mapPoints.waypoints=k.waypoints,n.hireInfo=D,n.routeInfo=w,localStorage.getItem(o)?($("#journeyName").tooltipster("content","This name already exists. Please try another"),$("#journeyName").tooltipster("open")):($("#journeyName").tooltipster("close"),localStorage.setItem(o,JSON.stringify(n)),void 0!==t&&t())}else $("#journeyName").tooltipster("content","Please enter a name to save the file as"),$("#journeyName").tooltipster("open")}($("#journeyName").val(),function(){$("#saveJourneyNamePopup").fadeOut(f),$("#journeySavedMessage").fadeIn(f),setTimeout(function(){$("#journeyName").val(""),e("#journeySavedMessage","hide")},2e3)})}),$("#modifyRequestButton").click(function(t){t.preventDefault(),e("#noVehicleMatchesPopup","hide"),i("#sectionFive","#sectionSeven")}),$(document).ajaxStart(function(){$("#ajaxLoading").fadeIn(f),$("#mask").fadeIn(f)}).ajaxStop(function(){$("#ajaxLoading").fadeOut(f),$("#mask").fadeOut(f)}),n("#sectionOne"),s("#origin",y,"Please enter a start point","originGeocoder"),s("#waypoints",y,"Please enter a stop"),s("#destination",y,"Please enter your destination","destinationGeocoder"),$("#originGeocoder .geocoder-pin-right .geocoder-icon-close").click(function(e){e.preventDefault(),k.origin=null}),$("#destinationGeocoder .geocoder-pin-right .geocoder-icon-close").click(function(e){e.preventDefault(),k.destination=null}),$(".tooltip").tooltipster({theme:"tooltipster-punk",trigger:"custom"}),$(".vehicle-options").slick({arrows:!0,prevArrow:'<i class="fa fa-angle-left slick-prev">Previous</i>',nextArrow:'<i class="fa fa-angle-right slick-next">Previous</i>',centerMode:!0,slidesToShow:1,infinite:!1,autoplay:!0,autoplaySpeed:1}),function(t){for(var n=function(n){$(document).on("click","#"+t[n]+"MoreInfo",function(o){o.preventDefault(),function(e,t,n){for(var o=0;o<e.vehicles.length;o++)if(e.vehicles[o].vehicle===t){var i=e.vehicles[o],a=$("#moreVehicleInfoPopup")[0].children[0],r=u(e.fuelPrice,i.mileage,w.distance[1]),s=D.days.totalDays*i.dailyRate,c=(r[1]+s).toFixed(2),l=[w.distance[0],D.persons+" person(s)",D.days.totalDays+" day(s)","$"+s+".00 NZD","Daily Rate x Hire Duration",r[0],"$"+e.fuelPrice+"/litre x "+i.mileage+"/100km x "+w.distance[0],"$"+c+" NZD"];a.children[1].textContent=i.name,a.children[2].setAttribute("src",i.imageURL);for(var d=0;d<l.length;d++)a.children[3].children[1].children[0].children[d].children[1].textContent=l[d]}void 0!==n&&n()}(x,t[n],function(){e("#moreVehicleInfoPopup","show")})})},o=0;o<t.length;o++)n(o)}(["motorbike","smallCar","largeCar","motorHome"])});